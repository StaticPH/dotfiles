#! /bin/bash

__currentLoc="$(realpath $(dirname "$0"))"

# If there isn't already a dedicated directory in which to place all generated files, attempt to make one
# TODO: Prompt the user for this directory or accept it as a parameter.
__dest="$(dirname $__currentLoc)"/generated

function creationFailed(){
cat << EOF
Unable to create a directory at $__dest
$(basename $(basename $0 .sh) .bash): Exiting...
EOF
exit 1
}

if [ ! -d "$__dest" ]; then
	mkdir -p "$__dest" || creationFailed
fi

# Run through all the generation scripts
# That includes auto-generating completion files and aliases
# Some of these scripts depend on one or more of the following:
#     powershell
#     rg (ripgrep, though they could have easily used grep instead)
#     access to the Windows folder, either directly by `/c/Windows` or by the environment variable `$SYSTEMROOT`
#     access to the `sudo` command, and permission to execute it

### Generators that will overwrite any (relevant) generated files that already exist
$__currentLoc/aliasWinExecs.sh "$__dest"	# TODO: Add check for OS; Windows Only
$__currentLoc/aliasWin32Execs.sh "$__dest"	# TODO: Add check for OS; Windows Only
	# !!!TODO:  Add note to generated .sys32Aliases containing a list of aliases that are the most likely to be of use
# !!TODO: Script that creates aliases for things in /c/Windows/System32/Wbem

### Generators that will only generate files that do not already exist.
$__currentLoc/genCommonMachineSetup.sh # The files generated by this script will show up in your home directory ($HOME), rather than in the default generated file directory.

## Note: seemsLikeWSL is located in .setup_base_env
[ $(seemsLikeWSL) ] && $__currentLoc/establishWSLConf.sh # This will create a bare-bones wsl.conf file at /etc/wsl.conf, executing itself using sudo if necessary

# !!TODO:
# if ripgrep version >= 11.0.0
#     generate .ripgreprc
# else utilize ripgrepExtraTypes
#
# generate assorted command completions?

# Make sure to remove any temporary environment variables, because who knows how long this terminal session will stay open, and what else will happen during it.
# No need to clutter the environment. Not that any of these should have remained in the environment anyways.
unset __dest __currentLoc creationFailed
